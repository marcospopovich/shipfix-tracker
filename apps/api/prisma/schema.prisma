generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  TECHNICIAN
  OWNER
}

enum VesselStatus {
  OPERATIVO
  EN_MANTENIMIENTO
  INACTIVO
}

enum EquipmentCategory {
  ELECTRONICA
  MOTORES
  HIDRAULICA
  SEGURIDAD
  COMUNICACIONES
  OTROS
}

enum EquipmentStatus {
  OPERATIVO
  EN_REPARACION
  FUERA_SERVICIO
}

enum FailureSeverity {
  BAJA
  MEDIA
  ALTA
}

enum FailureStatus {
  ABIERTA
  EN_DIAGNOSTICO
  EN_REPARACION
  RESUELTA
}

enum WorkOrderStatus {
  PENDIENTE
  EN_PROGRESO
  EN_REPARACION
  COMPLETADA
  CANCELADA
}

enum MaintenanceStatus {
  PROGRAMADO
  EN_CURSO
  COMPLETADO
  VENCIDO
}

enum MaintenanceEventStatus {
  PENDIENTE
  EN_CURSO
  COMPLETADO
  REPROGRAMADO
}

enum ReportType {
  OPERATIVO
  COSTOS
  DISPONIBILIDAD
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  role      Role
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workOrders WorkOrder[]
  reports    Report[]
}

model Vessel {
  id              String             @id @default(uuid())
  name            String
  registration    String             @unique
  owner           String
  homePort        String
  status          VesselStatus
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt

  equipments       Equipment[]
  failures         Failure[]
  maintenancePlans MaintenancePlan[]
}

model Equipment {
  id           String            @id @default(uuid())
  vesselId     String
  name         String
  category     EquipmentCategory
  serialNumber String
  status       EquipmentStatus
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt

  vessel           Vessel            @relation(fields: [vesselId], references: [id])
  failures         Failure[]
  maintenancePlans MaintenancePlan[]

  @@index([vesselId])
}

model Failure {
  id          String         @id @default(uuid())
  vesselId    String
  equipmentId String?
  title       String
  description String
  severity    FailureSeverity
  status      FailureStatus
  reportedAt  DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  vessel     Vessel    @relation(fields: [vesselId], references: [id])
  equipment  Equipment? @relation(fields: [equipmentId], references: [id])
  workOrders WorkOrder[]

  @@index([vesselId])
  @@index([equipmentId])
}

model WorkOrder {
  id           String         @id @default(uuid())
  failureId    String
  assignedToId String?
  status       WorkOrderStatus
  priority     FailureSeverity
  scheduledAt  DateTime?
  completedAt  DateTime?
  notes        String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  failure   Failure @relation(fields: [failureId], references: [id])
  assignedTo User?  @relation(fields: [assignedToId], references: [id])

  @@index([failureId])
  @@index([assignedToId])
}

model MaintenancePlan {
  id            String            @id @default(uuid())
  vesselId      String
  equipmentId   String?
  title         String
  frequencyDays Int
  nextDueDate   DateTime
  status        MaintenanceStatus
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  vessel           Vessel            @relation(fields: [vesselId], references: [id])
  equipment        Equipment?        @relation(fields: [equipmentId], references: [id])
  maintenanceEvents MaintenanceEvent[]

  @@index([vesselId])
  @@index([equipmentId])
}

model MaintenanceEvent {
  id           String                 @id @default(uuid())
  planId       String
  scheduledFor DateTime
  completedAt  DateTime?
  status       MaintenanceEventStatus
  notes        String?
  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt

  plan MaintenancePlan @relation(fields: [planId], references: [id])

  @@index([planId])
}

model Report {
  id          String     @id @default(uuid())
  title       String
  type        ReportType
  periodStart DateTime
  periodEnd   DateTime
  createdAt   DateTime   @default(now())
  createdById String

  createdBy User @relation(fields: [createdById], references: [id])

  @@index([createdById])
}
